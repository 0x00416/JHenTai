# Automatically generated on 2022-03-29 UTC from https://codemagic.io/app/6241e82d971f5851f21c11f1/settings
# Note that this configuration is not an exact match to UI settings. Review and adjust as necessary.

workflows:
  default-workflow:
    name: Default Workflow
    max_build_duration: 60
    environment:
      flutter: 2.10.2
      xcode: latest
      cocoapods: default
    scripts:
      - flutter packages pub get
      - find . -name "Podfile" -execdir pod install \;
      - keychain initialize
      - |
        # set up provisioning profiles
        PROFILE_PATH="$(mktemp "$HOME/Library/MobileDevice/Provisioning Profiles"/ios.mobileprovision)"
        echo "$CM_PROVISIONING_PROFILE" | base64 --decode > "$PROFILE_PATH"
        echo "Saved provisioning profile $PROFILE_PATH"
      - |
        # set up ios signing certificate
        echo $CM_CERTIFICATE | base64 --decode > '/tmp/certificate.p12'
        keychain add-certificates --certificate /tmp/certificate.p12 --certificate-password $CM_CERTIFICATE_PASSWORD
      - xcode-project use-profiles
      - flutter build ios -t lib/src/main.dart
      - xcodebuild profile -workspace ios/Runner.xcworkspace -scheme Runner -configuration Release
    artifacts:
      - build/ios/ipa/*.ipa
      - /tmp/xcodebuild_logs/*.log
      - '*.snap'
      - build/windows/**/*.msix
      - flutter_drive.log
      - ./**/*.app
    publishing:
      email:
        recipients:
          - jiangtian616@qq.com
